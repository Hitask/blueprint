// Copyright 2015 Palantir Technologies, Inc. All rights reserved.
// Licensed under the BSD-3 License as modified (the “License”); you may obtain a copy
// of the license at https://github.com/palantir/blueprint/blob/master/LICENSE
// and https://github.com/palantir/blueprint/blob/master/PATENTS

@import "../../common/mixins";
@import "../../common/variables";

$white-transparent: rgba($white, 0) !default;

$button-color: $white !default;
$button-color-hover: $white !default;
$button-color-active: $white !default;
$button-color-disabled: $pt-text-color-disabled !default;
$button-border-width: 0 !default;
$button-padding: 0 ($pt-grid-size * 2) !default;
$button-padding-large: 0 ($pt-grid-size * 1.5) !default;
$button-icon-spacing: ($pt-button-height - $pt-icon-size-standard) / 2 !default;
$button-icon-spacing-large: ($pt-button-height-large - $pt-icon-size-large) / 2 !default;
$dark-button-color-disabled: $pt-dark-text-color-disabled !default;

$button-border-color: rgba($black, 0.1) rgba($black, 0.1) rgba($black, 0.17) rgba($black, 0.1) !default;
$button-border-color-hover: rgba($black, 0.2) rgba($black, 0.2) rgba($black, 0.27) rgba($black, 0.2) !default;
$button-border-color-active: rgba($black, 0.35) rgba($black, 0.25) rgba($black, 0.25) rgba($black, 0.25) !default;
$button-box-shadow: inset 0 1.5px 0.5px 0.8px rgba($black, 0.2) !default;
$dark-button-border-color: rgba($black, 0.6) !default;
$dark-button-border-color-hover: rgba($black, 0.8) !default;
$dark-button-box-shadow: 0 1px 1px rgba($black, 0.2) !default;

$button-intent-border-color: rgba($black, 0.1) rgba($black, 0.1) rgba($black, 0.3) rgba($black, 0.1) !default;
$button-intent-border-color-active: rgba($black, 0.6) rgba($black, 0.2) rgba($black, 0.2) rgba($black, 0.2) !default;
$button-intent-box-shadow: 0 1px 1px rgba($black, 0.2) !default;
$dark-button-intent-border-color: rgba($black, 0.6) !default;
$dark-button-intent-box-shadow: 0 1px 1px rgba($black, 0.2) !default;

$button-background-color: $pt-main-color !default;
$button-background-color-hover: $pt-main-color-light !default;
$button-background-color-active: $pt-main-color-light !default;
$button-background-color-disabled: rgba($light-gray1, 0.5) !default;
$button-background-color-active-disabled: rgba($light-gray2, 0.4) !default;
$dark-button-background-color: none !default;
$dark-button-background-color-hover: rgba($white, 0.1) !default;
$dark-button-background-color-active: rgba($black, 0.1) !default;
$dark-button-background-color-disabled: rgba($light-gray1, 0.1) !default;
$dark-button-background-color-active-disabled: rgba($light-gray1, 0.2) !default;

$minimal-button-color: $pt-text-color !default;
$minimal-button-color-hover: $pt-text-color !default;
$minimal-button-color-active: $pt-text-color !default;
$minimal-button-color-disabled: $pt-text-color-disabled !default;
$minimal-button-divider-width: 1px !default;
$minimal-button-background-color: none !default;
$minimal-button-background-color-hover: rgba($gray4, 0.3) !default;
$minimal-button-background-color-active: rgba($gray4, 0.3) !default;
$dark-minimal-button-background-color: none !default;
$dark-minimal-button-background-color-hover: rgba($gray3, 0.15) !default;
$dark-minimal-button-background-color-active: rgba($gray3, 0.3) !default;

$icon-button-color: $pt-control-active;
$icon-button-color-hover: $pt-control-active;
$icon-button-color-active: $pt-control-active;
$icon-button-color-disabled: $button-color-disabled;
$icon-button-background-disabled: $button-background-color-disabled;

// "intent": (default, hover, active colors)
$button-intents: (
  "primary": ($pt-intent-primary, $blue2, $blue1),
  "success": ($pt-intent-success, $green2, $green1),
  "warning": ($pt-intent-warning, $orange2, $orange1),
  "danger": ($pt-intent-danger, $red2, $red1)
);

// animating shadows requires the same number of shadows in different states
@function input-transition-shadow($color: $input-shadow-color, $focus: false, $hover: false) {
  @if $focus {
    @return inset border-shadow(1, $color, 2px);
  }

  @if $hover {
    @return inset border-shadow(1, $color, 1px);
  }
  @return inset border-shadow(1, $color, 1px);
}

@function dark-input-transition-shadow($color: $dark-input-focus-shadow-color, $focus: false) {
  @if $focus {
    @return
      border-shadow(1, $color, 1px),
      border-shadow(1, $color, 1px), // duplicating to minimize browser antialiasing in dark
      border-shadow(0.3, $color, 3px);
  } @else {
    @return
      border-shadow(0, $color, 0),
      border-shadow(0, $color, 0),
      border-shadow(0, $color, 0);
  }
}

// matches default buttons only -- used to remove border-right in button groups and control groups
$non-default-state-selectors: ":last-child, :hover, :active, .pt-active, [class*=\"pt-intent-\"]";

@mixin pt-button-base() {
  display: inline-block;
  outline: none;
  border: $button-border-width solid;
  border-radius: $pt-border-radius;
  cursor: pointer;
  padding: $button-padding;
  vertical-align: middle;
  font-size: $pt-font-size;
  transition: background-color $pt-transition-ease $pt-transition-duration,
    color $pt-transition-ease $pt-transition-duration;
  user-select: none;
}

@mixin pt-button-height($height) {
  min-width: $height;
  min-height: $height;
  // for text centering
  line-height: $height - $button-border-width * 2;
}

@mixin pt-button() {
  background: $button-background-color;
  color: $button-color;

  &:hover {
    @include pt-button-hover();
  }

  &:active,
  &.pt-active {
    @include pt-button-active();
  }

  &:disabled,
  &.pt-disabled,
  &.pt-disabled:hover {
    box-shadow: none;
    background: $button-background-color-disabled;
    cursor: not-allowed;
    color: $button-color-disabled;
  }
}


@mixin pt-button-hover() {
  background: $button-background-color-hover;
  color: $button-color-hover;
}

@mixin pt-button-active() {
  box-shadow: $button-box-shadow;
  background: $button-background-color-active;
  color: $button-color-active;
}

@mixin pt-button-intent($default-color, $hover-color, $active-color) {
  background: $default-color;
  color: $white;

  &:hover {
    background: $hover-color;
  }

  &:active {
    box-shadow: inset $button-intent-box-shadow;
    background: $active-color;
  }

  &:disabled {
    background: rgba($default-color, 0.5);
  }
}

@mixin pt-dark-button() {
  @include linear-gradient-with-fallback(rgba($white, 0.1), rgba($white, 0.06), $dark-button-background-color);

  border-color: $dark-button-border-color;
  box-shadow: $dark-button-box-shadow;
  background-clip: padding-box;
  color: $pt-dark-text-color;

  &:hover,
  &:active {
    color: $pt-dark-text-color;
  }

  &:hover {
    @include pt-dark-button-hover();
  }

  &:active {
    @include pt-dark-button-active();
  }

  &:disabled {
    border-color: $dark-button-background-color-disabled;
    box-shadow: none;
    background: $dark-button-background-color-disabled;
    background-image: none;
    color: $dark-button-color-disabled;
  }
}

@mixin pt-dark-button-hover() {
  @include linear-gradient-with-fallback(rgba($black, 0.1), rgba($black, 0.2), $dark-button-background-color-hover);

  border-color: $dark-button-border-color-hover;
  box-shadow: $dark-button-box-shadow;
  background-clip: padding-box;
}

@mixin pt-dark-button-active() {
  box-shadow: inset $dark-button-box-shadow;
  background: $dark-button-background-color-active;
  background-image: none;
}

@mixin pt-dark-button-intent() {
  border-color: $dark-button-intent-border-color;
  box-shadow: $dark-button-intent-box-shadow;
  background-clip: padding-box;

  &:hover {
    box-shadow: $dark-button-intent-box-shadow;
  }

  &:active {
    box-shadow: inset $dark-button-intent-box-shadow;
  }

  &:disabled {
    border: none;
    box-shadow: none;
    background-image: none;
    color: rgba($white, 0.3);
  }
}

@mixin pt-button-minimal() {
  background: $minimal-button-background-color;
  color: $minimal-button-color;

  &:hover {
    background: $minimal-button-background-color-hover;
    text-decoration: none;
    color: $minimal-button-color-hover;
  }

  &.pt-active,
  &:active {
    background: $minimal-button-background-color-active;
    color: $minimal-button-color-active;
  }

  &.pt-disabled,
  &:disabled,
  &:disabled:hover {
    background: inherit;
    cursor: not-allowed;
    color: $minimal-button-color-disabled;
  }

  .pt-dark & {
    border-color: transparent;
    box-shadow: none;
    background: $dark-minimal-button-background-color;
    color: inherit;

    &:hover,
    &:active,
    &.pt-active {
      border-color: transparent;
      box-shadow: none;
      background: none;
    }

    &:hover {
      background: $dark-minimal-button-background-color-hover;
    }

    &:active,
    &.pt-active {
      background: $dark-minimal-button-background-color-active;
      color: $pt-dark-text-color;
    }

    &.pt-disabled,
    &:disabled,
    &:disabled:hover {
      border-color: transparent;
      background: inherit;
      cursor: not-allowed;
      color: $pt-dark-text-color-disabled;
    }
  }

  @each $intent, $colors in $button-intents {
    &.pt-intent-#{$intent} {
      @include pt-button-minimal-intent(
        map-get($pt-intent-colors, $intent),
        map-get($pt-intent-text-colors, $intent),
        map-get($pt-dark-intent-text-colors, $intent)
      );
    }
  }
}

@mixin pt-button-minimal-intent($intent-color, $text-color, $dark-text-color) {
  color: $text-color;

  &:hover,
  &:active,
  &.pt-active {
    box-shadow: none;
    background: none;
    color: $text-color;
  }

  &:hover {
    background: rgba($intent-color, 0.15);
  }

  &:active,
  &.pt-active {
    background: rgba($intent-color, 0.3);
    color: $text-color;
  }

  &:disabled,
  &.pt-disabled {
    background: none;
    color: rgba($text-color, 0.5);
  }

  .pt-dark & {
    color: $dark-text-color;

    &:hover {
      background: rgba($intent-color, 0.2);
      color: $dark-text-color;
    }

    &:active,
    &.pt-active {
      background: rgba($intent-color, 0.3);
      color: $dark-text-color;
    }

    &:disabled,
    &.pt-disabled {
      color: rgba($dark-text-color, 0.5);
    }
  }
}

@mixin pt-button-minimal-divider() {
  $divider-height: $pt-grid-size * 2;

  margin: ($pt-button-height - $divider-height) / 2;
  background: $pt-divider-black;
  width: $minimal-button-divider-width;
  height: $divider-height;

  .pt-dark & {
    background: $pt-dark-divider-white;
  }
}

@mixin pt-button-large() {
  @include pt-button-height($pt-button-height-large);

  padding: $button-padding-large;
  font-size: $pt-font-size-large;
}

@mixin pt-button-round() {
  position: relative;
  border-radius: 50%;
  box-shadow: input-transition-shadow($icon-button-color, false);
  background: transparent;
  color: $icon-button-color;
  transition: box-shadow $pt-transition-duration $pt-transition-ease,
    background-color $pt-transition-duration $pt-transition-ease,
    color $pt-transition-duration $pt-transition-ease;

  &:hover,
  &:active,
  &.pt-active {
    box-shadow: input-transition-shadow($icon-button-color-active, true);
    background: transparent;
    color: $icon-button-color-active;

    .pt-button-helptext {
      opacity: 1;
    }
  }

  &.pt-large::before {
    font-size: 18px;
  }

  &.pt-minimal {
    box-shadow: none;

    &:hover {
      box-shadow: none;
      background: $minimal-button-background-color-hover;
    }

    &:active {
      box-shadow: $button-box-shadow;
      background: $minimal-button-background-color-hover;
    }

    &:disabled,
    &.pt-disabled,
    &.pt-disabled:hover {
      box-shadow: none;
      background: transparent;
      color: rgba($icon-button-color, 0.5);
    }
  }

  @each $intent, $colors in $button-intents {
    &.pt-intent-#{$intent} {
      @include pt-button-round-intent(
        map-get($pt-intent-colors, $intent),
        map-get($pt-intent-text-colors, $intent),
        map-get($pt-dark-intent-text-colors, $intent)
      );
    }
  }
}

@mixin pt-button-round-intent($intent-color, $text-color, $dark-text-color) {
  color: $intent-color;

  &:not(.pt-minimal) {
    box-shadow: input-transition-shadow($intent-color, false);
  }

  &:hover,
  &:active,
  &.pt-active {
    color: $intent-color;
  }

  &:not(.pt-minimal):hover,
  &:not(.pt-minimal):active,
  &:not(.pt-minimal).pt-active {
    box-shadow: input-transition-shadow($intent-color, true);
  }

  &:disabled,
  &.pt-disabled,
  &.pt-disabled:hover {
    box-shadow: none;
    background: rgba($intent-color, 0.2);
    color: rgba($intent-color, 0.5);
  }
}

@mixin pt-button-helptext() {
  display: block;
  position: absolute;
  bottom: 100%;
  left: -100%;
  opacity: 0;
  width: 300%;
  padding-bottom: 5px;
  line-height: $pt-line-height;
  font-size: $pt-font-size-small;
  transition: opacity $pt-transition-duration $pt-transition-ease;
}
